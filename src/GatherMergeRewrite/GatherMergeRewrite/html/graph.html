<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>graph</title>
    <script src="/content/d3.v3.min.js"></script>
    <script src="/content/graph.js"></script>
    <script src="/content/Promise.js"></script>
    <script src="/content/jsonld.js"></script>
    <link rel="stylesheet" type="text/css" href="/content/graph.css" />
</head>
<body>
    <a id="resource" href="">link</a>
    <div id="current"></div>

    <script>

        var further = function (flattened) {
            var result = [];
            for (var i = 0; i !== flattened.length; i += 1) {
                var subject = flattened[i]['@id'];
                for (var prop in flattened[i]) {
                    if (prop !== '@id') {
                        var predicate = prop;
                        for (var j = 0; j !== flattened[i][prop].length; j += 1) {
                            var object = {};
                            if (flattened[i][prop][j]['@id'] !== undefined) {
                                object = { value: flattened[i][prop][j]['@id'], type: 'uri' };
                            }
                            else {
                                object = { value: flattened[i][prop][j]['@value'], type: 'literal' };
                            }
                            result[result.length] = { subject: subject, predicate: predicate, object: object };
                        }
                    }
                }
            }
            return result;
        }

        var chart = graph();

        chart.prefixTable = [
            { prefix: 'nuget', uri: 'http://nuget.org/schema#' },
            { prefix: 'rdf', uri: 'http://www.w3.org/1999/02/22-rdf-syntax-ns#' }
        ];

        //chart.navigate = function (address) { location.assign(address); }

        var address = d3.select('#resource').attr('href')

        d3.json(address, function (error, doc) {
            jsonld.flatten(doc, function (err, flattened) {
                var triples = further(flattened);
                d3.select("#current").datum(triples).call(chart);
            });
        });
    </script>
</body>
</html>